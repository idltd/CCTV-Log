<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#1a56db">
    <title>CCTV SAR</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.svg">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<header>
    <div class="header-row">
        <h1>CCTV SAR</h1>
        <span class="header-sub">Request Your Footage</span>
    </div>
    <nav class="nav-buttons">
        <button class="nav-btn active" data-section="home">Home</button>
        <button class="nav-btn" data-section="request">Capture</button>
        <button class="nav-btn" data-section="log">My Log</button>
        <button class="nav-btn" data-section="profile">My Details</button>
        <button class="nav-btn" data-section="about">About</button>
    </nav>
</header>

<main>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="section-home" class="section">

        <div class="hero">
            <div class="hero-icon">üìπ</div>
            <h2>Request Your CCTV Footage</h2>
            <p>Photograph a CCTV camera, identify the operator, and send a legally correct
               Subject Access Request ‚Äî all from your phone.</p>
            <div class="hero-btns">
                <button class="btn btn-primary btn-large btn-full" id="btn-capture">
                    üì∑ Capture Incident
                </button>
                <button class="btn btn-secondary btn-full" id="btn-go-profile">
                    Set Up My Details First
                </button>
            </div>
        </div>

        <!-- Log summary ‚Äî hidden when log is empty -->
        <div class="log-summary hidden" id="home-log-summary">
            <strong id="home-pending-count">0</strong> pending ¬∑
            <strong id="home-sent-count">0</strong> sent ‚Äî
            <a href="#" id="home-view-log">view My Log</a>
        </div>

        <details class="disclosure" style="margin-bottom:8px">
            <summary>About this app</summary>
            <div class="info-cards" style="margin-top:8px">
                <div class="card">
                    <strong>Your right</strong>
                    <p>Article 15 UK GDPR gives you the right to access personal data held
                       about you ‚Äî including CCTV footage captured in a public or semi-public place.</p>
                </div>
                <div class="card">
                    <strong>Act quickly</strong>
                    <p>CCTV footage is routinely overwritten within 7‚Äì31 days. The data controller
                       must respond within <strong>one calendar month</strong> of your request.</p>
                </div>
                <div class="card">
                    <strong>Free of charge</strong>
                    <p>Subject access requests are free unless they are manifestly unfounded
                       or excessive.</p>
                </div>
            </div>
        </details>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê REQUEST WIZARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="section-request" class="section hidden">

        <!-- Step indicator -->
        <div class="steps">
            <div class="step active" data-step="0">
                <div class="step-num">1</div>
                <div class="step-label">Photo</div>
            </div>
            <div class="step-line"></div>
            <div class="step" data-step="1">
                <div class="step-num">2</div>
                <div class="step-label">Camera</div>
            </div>
            <div class="step-line"></div>
            <div class="step" data-step="2">
                <div class="step-num">3</div>
                <div class="step-label">Details</div>
            </div>
            <div class="step-line"></div>
            <div class="step" data-step="3">
                <div class="step-num">4</div>
                <div class="step-label">Letter</div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Step 0 : Photograph ‚îÄ‚îÄ -->
        <div class="step-panel" id="step-0">
            <h2>Photograph the Camera</h2>
            <p class="hint">
                Point your phone at the CCTV camera ‚Äî ideally its signage too.
                Your location is captured at the same moment as timestamped evidence
                that you were present and likely recorded.
            </p>

            <div class="photo-preview" id="photo-preview">
                <div class="photo-placeholder">
                    <span class="ph-icon">üì∑</span>
                    <span>No photo taken yet</span>
                </div>
            </div>

            <div class="step-actions">
                <button class="btn btn-primary" id="btn-take-photo">Take Photo</button>
            </div>

            <div class="status-line hidden" id="gps-status"></div>

            <!-- Shown only when GPS is denied/unavailable -->
            <div class="postcode-fallback hidden" id="postcode-fallback">
                <div class="form-group" style="margin-top:12px">
                    <label for="postcode-input">Enter the postcode where the camera is</label>
                    <div class="postcode-row">
                        <input type="text" id="postcode-input"
                               placeholder="e.g. SE1 7EH" maxlength="8"
                               style="text-transform:uppercase">
                        <button class="btn btn-secondary" id="btn-postcode-search">
                            Search
                        </button>
                    </div>
                </div>
            </div>

            <div class="step-nav">
                <span></span>
                <button class="btn btn-primary" id="btn-step0-next" disabled>
                    Next ‚Äî Identify Camera ‚Üí
                </button>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Step 1 : Identify camera owner ‚îÄ‚îÄ -->
        <div class="step-panel hidden" id="step-1">
            <h2>Who Owns This Camera?</h2>
            <p class="hint">
                Tap a match from the registry, or <strong>Save to Log</strong> now
                and identify the operator later.
            </p>

            <div id="registry-results" class="hint">
                Searching registry‚Ä¶
            </div>

            <!-- Manual entry (collapsed by default) -->
            <details class="disclosure" id="manual-details">
                <summary>Enter details manually</summary>

                <div class="form-group">
                    <label for="manual-org">Organisation name *</label>
                    <input type="text" id="manual-org"
                           placeholder="e.g. Tesco Stores Ltd, City of London Corporation">
                </div>
                <div class="form-group">
                    <label for="manual-ico">ICO registration number</label>
                    <input type="text" id="manual-ico" placeholder="e.g. Z1234567">
                </div>
                <div class="form-group">
                    <label for="manual-email">Privacy / DPO email</label>
                    <input type="email" id="manual-email" placeholder="e.g. dpo@example.com">
                </div>
                <div class="form-group">
                    <label for="manual-addr">Postal address</label>
                    <textarea id="manual-addr" rows="3"
                              placeholder="Address to which the SAR letter will be sent"></textarea>
                </div>
                <button class="btn btn-secondary" id="btn-use-manual">
                    Use These Details
                </button>
            </details>

            <div class="selected-info hidden" id="selected-info"></div>

            <button class="btn btn-secondary btn-save-log" id="btn-save-to-log" disabled
                    title="Save this capture to your log to process later">
                Save to Log ‚Äî identify operator later
            </button>

            <div class="step-nav">
                <button class="btn btn-secondary" id="btn-step1-back">‚Üê Back</button>
                <button class="btn btn-primary"   id="btn-step1-next" disabled>
                    Next ‚Äî Add Details ‚Üí
                </button>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Step 2 : Incident details ‚îÄ‚îÄ -->
        <div class="step-panel hidden" id="step-2">
            <h2>Incident Details</h2>
            <p class="hint">
                These help the data controller locate your footage quickly.
                Date and time are pre-filled from your photo ‚Äî adjust if needed.
            </p>

            <div class="form-group">
                <label for="incident-date">Date</label>
                <input type="date" id="incident-date">
            </div>
            <div class="form-group">
                <label for="incident-time">Approximate time</label>
                <input type="time" id="incident-time">
                <small>The letter requests footage from 30 minutes before to 30 minutes after
                       the time you enter.</small>
            </div>
            <div class="form-group">
                <label for="self-description">Your appearance at the time</label>
                <textarea id="self-description" rows="4"
                          placeholder="e.g. Female, approximately 5 ft 5 in, wearing a red coat and dark jeans, carrying a green canvas bag. Short dark hair."></textarea>
                <small>The more detail you give, the easier it is for the operator to locate
                       the footage. Include height, build, clothing and any distinctive features.</small>
            </div>

            <div class="step-nav">
                <button class="btn btn-secondary" id="btn-step2-back">‚Üê Back</button>
                <button class="btn btn-primary"   id="btn-step2-next">
                    Generate Letter ‚Üí
                </button>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Step 3 : Letter ‚îÄ‚îÄ -->
        <div class="step-panel hidden" id="step-3">
            <h2>Your Letter</h2>
            <p class="hint">
                Review and edit the letter below. Your personal details are pre-filled from
                <em>My Details</em> ‚Äî you can change anything before sending.
            </p>

            <div class="form-group">
                <label for="email-subject">Email subject line</label>
                <input type="text" id="email-subject" readonly
                       title="Click Copy Subject to copy this">
            </div>

            <div class="form-group">
                <label for="letter-text">Letter body</label>
                <textarea id="letter-text" spellcheck="true"></textarea>
            </div>

            <!-- Warning shown if same operator contacted recently -->
            <div class="sar-warning hidden" id="sar-warning"></div>

            <div class="send-options">
                <button class="btn btn-primary"   id="btn-mailto">
                    Open in Email App
                </button>
                <button class="btn btn-secondary" id="btn-copy-letter">
                    Copy Letter
                </button>
                <button class="btn btn-secondary" id="btn-copy-subject">
                    Copy Subject
                </button>
            </div>

            <div class="status-line hidden" id="send-status"></div>

            <!-- Mark as sent ‚Äî user clicks after sending from their email app -->
            <button class="btn btn-secondary btn-full" id="btn-mark-sent"
                    style="margin-top:10px">
                ‚úì Mark as Sent
            </button>
            <div class="status-line hidden" id="sent-status"></div>

            <!-- Contribute panel ‚Äî hidden if no location/camera data -->
            <details class="disclosure" id="contribute-panel">
                <summary>Help others ‚Äî contribute camera details to registry</summary>
                <p class="hint" style="margin-top:8px">
                    Share just the camera's location and operator details so others in the
                    same situation can find them more quickly. No personal information is included.
                    Contributions are reviewed before going live.
                </p>
                <pre class="contribute-preview" id="contribute-preview"></pre>
                <button class="btn btn-secondary" id="btn-contribute">
                    Submit to Registry
                </button>
                <div class="status-line hidden" id="contribute-status"></div>
            </details>

            <div class="step-nav">
                <button class="btn btn-secondary" id="btn-step3-back">‚Üê Back</button>
                <button class="btn btn-secondary" id="btn-new-request">New Capture</button>
            </div>
        </div>

    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MY LOG ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="section-log" class="section hidden">
        <h2 style="margin-bottom:12px">My Log</h2>

        <div id="log-empty" class="hidden">
            <div class="empty-icon">üìã</div>
            <p>No incidents captured yet.</p>
            <p class="hint" style="margin-top:6px">
                Tap <strong>Capture Incident</strong> on the Home tab when you spot a CCTV camera.
            </p>
        </div>

        <div id="log-list"></div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFILE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="section-profile" class="section hidden">
        <h2 style="margin-bottom:8px">My Details</h2>
        <p class="hint">
            Stored on this device only ‚Äî never sent to any server.
            These pre-fill the header of your SAR letter.
            Leave anything blank and edit the letter manually.
        </p>

        <div class="form-group">
            <label for="profile-name">Your name</label>
            <input type="text" id="profile-name"
                   placeholder="Name as it should appear on the letter">
        </div>
        <div class="form-group">
            <label for="profile-address">Your address</label>
            <textarea id="profile-address" rows="3"
                      placeholder="Address for correspondence"></textarea>
        </div>
        <div class="form-group">
            <label for="profile-email">Your email address</label>
            <input type="email" id="profile-email" placeholder="you@example.com">
        </div>

        <button class="btn btn-primary" id="btn-save-profile">Save to Device</button>
        <div class="status-line hidden" id="profile-saved"></div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ABOUT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="section-about" class="section hidden">

        <div class="card" style="margin-bottom:10px">
            <strong>Your right to CCTV footage</strong>
            <p>Under <strong>Article 15 of the UK GDPR</strong> and <strong>Section 45 of the
               Data Protection Act 2018</strong>, you have the right to request a copy of any
               personal data held about you ‚Äî including CCTV footage in which you appear.</p>
            <p>This right applies whether the camera is operated by a business, a local
               authority, a housing association, a pub, a shop, or any other organisation.
               Private individuals operating cameras that capture public areas are also
               covered in most circumstances.</p>
            <p>The data controller <strong>must respond within one calendar month</strong> and
               cannot charge a fee for a standard request. If the footage has already been
               overwritten, they must confirm this in writing.</p>
        </div>

        <div class="card" style="margin-bottom:10px">
            <strong>Act quickly ‚Äî footage is overwritten fast</strong>
            <p>Most CCTV systems overwrite footage automatically after 7 to 31 days,
               sometimes sooner. Send your request as soon as possible after the incident.</p>
            <p>The photograph you take with this app creates a timestamped record of your
               presence at the camera's location. Keep that photo ‚Äî along with a copy of
               your sent email ‚Äî as evidence of your request.</p>
        </div>

        <div class="card" style="margin-bottom:10px">
            <strong>What you need to provide</strong>
            <p>Your request just needs to give the controller enough information to find
               you in the footage:</p>
            <ul style="margin:6px 0 0 18px; font-size:0.88em; color:#6b7280; line-height:1.8">
                <li>The date, time and location of the incident</li>
                <li>A description of your appearance on the day</li>
                <li>A contact address ‚Äî an email address is sufficient</li>
            </ul>
            <p style="margin-top:8px">You do <strong>not</strong> need to give your home
               address or prove your identity with documents. If you prefer, use a dedicated
               email address for SAR requests ‚Äî keeping it separate from your everyday account.</p>
        </div>

        <div class="card" style="margin-bottom:10px">
            <strong>If the controller refuses or ignores you</strong>
            <p>A controller can only refuse if the request is manifestly unfounded or
               excessive ‚Äî a specific, evidence-backed request for footage of yourself is
               neither. If they refuse without valid reason, or fail to respond within a
               month, you can complain to the ICO.</p>
            <p>You can also apply to the court for an order compelling disclosure, though
               an ICO complaint is usually the faster route.</p>
            <a class="btn btn-secondary"
               href="https://ico.org.uk/make-a-complaint/"
               target="_blank" rel="noopener">Make an ICO Complaint</a>
            <a class="btn btn-secondary"
               href="https://ico.org.uk/for-organisations/guide-to-data-protection/guide-to-the-general-data-protection-regulation-gdpr/individual-rights/right-of-access/"
               target="_blank" rel="noopener">ICO Guidance on SARs</a>
        </div>

        <div class="card" style="margin-bottom:10px">
            <strong>Privacy ‚Äî this app knows nothing about you</strong>
            <p>Your name and email address are stored <strong>on this device only</strong>,
               in your browser's local storage. They are never transmitted anywhere.</p>
            <p>Your letter is sent by your own email app ‚Äî this app never touches it after
               handing it over. Your email provider's sent folder is your record.</p>
            <p>The GPS coordinates used to search the camera registry are used in-session
               only and are not stored or transmitted with any identifying information.</p>
            <p>The camera registry itself contains only factual, publicly available
               information: operator names, ICO registration numbers, and DPO contact
               details. No user data is ever recorded there.</p>
        </div>

        <div class="card" style="margin-bottom:10px">
            <strong>Camera Registry</strong>
            <p>The shared registry of known cameras and their operators is
               community-maintained on GitHub. All submissions are reviewed before
               publication. Anyone can contribute ‚Äî no account required beyond GitHub.</p>
            <a class="btn btn-secondary"
               href="https://github.com/idltd/cctv-sar-db"
               target="_blank" rel="noopener">View the Registry</a>
            <a class="btn btn-secondary"
               href="https://github.com/idltd/cctv-sar-db/issues/new?template=camera.yml"
               target="_blank" rel="noopener">Submit a Camera</a>
        </div>

        <div class="card">
            <p class="muted" style="font-size:0.82em; line-height:1.7">
                CCTV SAR v1.0 &middot; Built for UK users &middot;
                Open source: <a href="https://github.com/idltd/CCTV-Log" target="_blank" rel="noopener">github.com/idltd/CCTV-Log</a>
                <br>
                <strong>Not legal advice.</strong> If you need legal guidance, consult a
                solicitor or contact <a href="https://ico.org.uk" target="_blank" rel="noopener">ico.org.uk</a>.
            </p>
        </div>

    </section>

</main>

<!-- Hidden canvas for thumbnail generation -->
<canvas id="thumb-canvas" style="display:none" width="320" height="240"></canvas>

<script type="module" src="js/app.js"></script>
</body>
</html>
